#
# Copyright (C) 2015 The Gravitee team (http://gravitee.io)
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#         http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
apiVersion: gravitee.io/v1alpha1
kind: ApiV4Definition
metadata:
  name: api-v4-with-mcp-entrypoint
spec:
  contextRef:
    name: dev-ctx
  name: api-v4-with-mcp-entrypoint
  version: "1.0"
  type: PROXY
  description: "API V4 with MCP that uses the Open-Weather API as a tool."
  listeners:
    - type: "HTTP"
      paths:
        - path: "/open-weatherapis/"
          overrideAccess: true
      entrypoints:
        - type: "http-proxy"
        - type: "mcp"
          qos: "AUTO"
          configuration:
            mcpPath: "/mcp"
            tools:
              - gatewayMapping:
                  http:
                    path: "/forecast"
                    method: "GET"
                    queryParams:
                      - "latitude"
                      - "longitude"
                      - "current"
                      - "timezone"
                      - "wind_speed_unit"
                toolDefinition:
                  inputSchema:
                    type: "object"
                    properties:
                      current:
                        description: "Comma-separated list of current weather variables to fetch."
                        type: "string"
                        example: "temperature_2m,wind_speed_10m"
                      wind_speed_unit:
                        description: "Unit for wind speed."
                        type: "string"
                        enum:
                          - "kmh"
                          - "ms"
                          - "mph"
                          - "kn"
                        example: "kmh"
                      timezone:
                        description: "Timezone for the output. Use `auto` to detect automatically."
                        type: "string"
                        example: "auto"
                      latitude:
                        format: "float"
                        description: "Latitude of the location."
                        type: "number"
                        example: 40.7128
                      longitude:
                        format: "float"
                        description: "Longitude of the location."
                        type: "number"
                        example: -74.006
                    required:
                      - "latitude"
                      - "longitude"
                      - "current"
                      - "timezone"
                      - "wind_speed_unit"
                  name: "get_forecast"
                  description: "Get current weather"
  endpointGroups:
    - name: Default endpoint group
      type: http-proxy
      loadBalancer:
        type: ROUND_ROBIN
      endpoints:
        - name: default
          type: http-proxy
          weight: 1
          inheritConfiguration: false
          configuration:
            target: https://api.open-meteo.com/v1
          secondary: false
  plans:
    KeyLess:
      name: "Free plan"
      description: "This plan does not require any authentication"
      security:
        type: "KEY_LESS"
  flowExecution:
    mode: DEFAULT
    matchRequired: false
  visibility: "PRIVATE"
  state: "STARTED"
  definitionVersion: "V4"
